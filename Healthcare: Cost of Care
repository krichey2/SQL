--Cost of Care: What does cost of care look
like for our patients?

--What is total claim cost for each encounter in 2019?

SELECT SUM(TOTAL_CLAIM_COST) AS TOTAL_FOR_2019
FROM HEALTHCARE.ENCOUNTERS
WHERE START >= 2019-01-01
AND START < 2020-01-01;

--$406,208

SELECT SUM(TOTAL_CLAIM_COST) AS TOTAL_FOR_2019
,AVG(TOTAL_CLAIM_COST) AS AVG_FOR_2019
FROM HEALTHCARE.ENCOUNTERS
WHERE START >= 2019-01-01
AND START < 2020-01-01;

--$128.83 average 

--What is total payer coverage for each encounter in 2019?

SELECT
,SUM(TOTAL_CLAIM_COST) AS TOTAL_CLAIMS_FOR_2019
,AVG(TOTAL_CLAIM_COST) AS AVG_CLAIMS_FOR_2019
,SUM(PAYER_COVERAGE) AS TOTAL_PAYER_COVERAGE_FOR_2019
,AVG(PAYER_COVERAGE) AS AVG_PAYER_COVERAGE_FOR_2019
FROM HEALTHCARE.ENCOUNTERS
WHERE START >= 2019-01-01
AND START < 2020-01-01;

--$213,041 difference

--Which encounter types had the highest cost?

SELECT 
PAYER
,NAME
,ENCOUNTERCLASS
-- SUM(TOTAL_CLAIM_COST) AS TOTAL_CLAIMS_FOR_2019
-- AVG(TOTAL_CLAIM_COST) AS AVG_CLAIMS_FOR_2019
-- SUM(PAYER_COVERAGE) AS TOTAL_PAYER_COVERAGE_FOR_2019
-- AVG(PAYER_COVERAGE) AS AVG_PAYER_COVERAGE_FOR_2019
,SUM(TOTAL_CLAIM_COST)-SUM(PAYER_COVERAGE) AS DIFFER_CLAIM_TO_PAYER_COV
,AVG(TOTAL_CLAIM_COST)-AVG(PAYER_COVERAGE) AS AVG_CLAIM_TO_PAYER_COV
FROM HEALTHCARE.ENCOUNTERS ENC
JOIN HEALTHCARE.PAYERS PAY ON ENC.PAYER=PAY.ID
WHERE START >= '2019-01-01'
AND START < '2020-01-01'
GROUP BY PAYER, ENCOUNTERCLASS, NAME
ORDER BY ENCOUNTERCLASS;


--Which encounter types had the highest cost covered by payers?

SELECT 
ENCOUNTERCLASS
-- SUM(TOTAL_CLAIM_COST) AS TOTAL_CLAIMS_FOR_2019
-- AVG(TOTAL_CLAIM_COST) AS AVG_CLAIMS_FOR_2019
-- SUM(PAYER_COVERAGE) AS TOTAL_PAYER_COVERAGE_FOR_2019
-- AVG(PAYER_COVERAGE) AS AVG_PAYER_COVERAGE_FOR_2019
,SUM(TOTAL_CLAIM_COST)-SUM(PAYER_COVERAGE) AS DIFFER_CLAIM_TO_PAYER_COV
,AVG(TOTAL_CLAIM_COST)-AVG(PAYER_COVERAGE) AS AVG_CLAIM_TO_PAYER_COV
FROM HEALTHCARE.ENCOUNTERS ENC
WHERE START >= '2019-01-01'
AND START < '2020-01-01'
GROUP BY  ENCOUNTERCLASS
ORDER BY ENCOUNTERCLASS;

--Urgent Care

-- Assignment questions:
-- What was the total claim cost for encounters before 2020? Return answer in whole dollars (round up to nearest dollar).

SELECT ROUND(SUM(TOTAL_CLAIM_COST),0)
FROM HEALTHCARE.ENCOUNTERS
WHERE START < 2020-01-01
;

-- $5,970,445

-- What was the total payer coverage for encounters before 2020? Return answer in whole dollars (round up to nearest dollar).
SELECT ROUND(SUM(PAYER_COVERAGE),0)
FROM HEALTHCARE.ENCOUNTERS
WHERE START <2020-01-01;

-- $2,840,311


-- Which payer (per this training dataset) had the highest claim coverage percentage (ttotal payer coverage/ total claim cost) for encounters before 2020?

SELECT PAYER
,NAME
,(PAYER_COVERAGE/TOTAL_CLAIM_COST) CLAIM_COV_PERCENT
FROM HEALTHCARE.ENCOUNTERS ENC
JOIN HEALTHCARE.PAYERS PAY ON ENC.PAYER=PAY.ID
WHERE START <=2020-01-01
ORDER BY CLAIM_COV_PERCENT DESC;


-- Which payer (per this training dataset) had the highest claim coverage percentage (total payer coverage / total claim cost) for ambulatory encounters before 2020?

SELECT 
PAYER
,NAME
,ENCOUNTERCLASS
,(PAYER_COVERAGE/TOTAL_CLAIM_COST) CLAIM_COV_PERCENT
FROM HEALTHCARE.ENCOUNTERS ENC
JOIN HEALTHCARE.PAYERS PAY ON ENC.PAYER=PAY.ID;
WHERE START <= 2020-01-01
WHERE ENCOUNTERCLASS = 'ambulatory'
ORDER BY CLAIM_COV_PERCENT DESC;
